<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community Chat</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
    * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
    background: linear-gradient(135deg, #6e8efb, #a777e3);
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 0;
    }
    
    .chat-container {
    width: 100%;
    height: 100%;
    background: #fff;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    }
    
    .chat-header {
    background: #4a6cfa;
    color: white;
    padding: 14px 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
    }
    
    .header-left {
    display: flex;
    align-items: center;
    }
    
    .profile-image-container {
    position: relative;
    margin-right: 12px;
    }
    
    .profile-image {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px solid rgba(255, 255, 255, 0.3);
    z-index: 2;
    position: relative;
    }
    
    .profile-image i {
    color: #4a6cfa;
    font-size: 20px;
    }
    
    .profile-background {
    position: absolute;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    top: -5px;
    left: -5px;
    z-index: 1;
    }
    
    .header-info {
    display: flex;
    flex-direction: column;
    }
    
    .chat-title {
    font-weight: 600;
    font-size: 16px;
    margin-bottom: 2px;
    position: relative;
    z-index: 2;
    }
    .online-info {
    display: flex;
    align-items: center;
    font-size: 12px;
    opacity: 0.9;
    }
    
    @keyframes blink {
    0% {
    box-shadow: 0 0 0 0 rgba(100, 206, 131, 0.7);
    }
    70% {
    box-shadow: 0 0 0 6px rgba(100, 206, 131, 0);
    }
    100% {
    box-shadow: 0 0 0 0 rgba(100, 206, 131, 0);
    }
    }
    .online-indicator {
    background: #4CAF50;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    margin-right: 6px;
    box-shadow: 0 0 10px rgba(100, 206, 131, 0.7);
    animation: blink 2s infinite;
    }
    
    
    
    .header-actions {
    display: flex;
    align-items: center;
    position: relative;
    z-index: 100;
    }
    
    .header-btn {
    background: none;
    border: none;
    color: white;
    font-size: 16px;
    cursor: pointer;
    margin-left: 12px;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    }
    
    .header-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    }
    
    .dropdown-menu {
    display: none;
    position: absolute;
    top: 100%;
    right: 10px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    width: 180px;
    z-index: 1000;
    overflow: hidden;
    }
    
    .dropdown-menu.show {
    display: block;
    }
    
    .dropdown-menu a {
    display: block;
    padding: 12px 16px;
    color: #333;
    text-decoration: none;
    transition: background 0.2s;
    font-size: 14px;
    }
    
    .dropdown-menu a i {
    margin-right: 8px;
    width: 16px;
    text-align: center;
    }
    
    .dropdown-menu a:hover {
    background: #f0f5ff;
    color: #4a6cfa;
    }
    
    .messages-container {
    flex: 1;
    padding: 16px;
    overflow-y: auto;
    background: #f0f2f5;
    display: flex;
    flex-direction: column;
    }
    
    .message {
    margin-bottom: 16px;
    display: flex;
    flex-direction: column;
    max-width: 85%;
    animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
    }
    
    .message.own {
    align-self: flex-end;
    }
    
    .message-info {
    display: flex;
    align-items: center;
    margin-bottom: 4px;
    }
    
    .message-user {
    font-size: 13px;
    font-weight: 600;
    color: #4a6cfa;
    }
    
    .message-time {
    font-size: 11px;
    color: #999;
    margin-left: 8px;
    }
    
    .message-content {
    padding: 10px 14px;
    border-radius: 18px;
    position: relative;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    line-height: 1.4;
    word-wrap: break-word;
    }
    
    .message.other .message-content {
    background: #e9e9eb;
    border-top-left-radius: 4px;
    }
    
    .message.own .message-content {
    background: #4a6cfa;
    color: white;
    border-top-right-radius: 4px;
    }
    
    .message-actions {
    display: none;
    position: absolute;
    bottom: -20px;
    right: 10px;
    background: white;
    border-radius: 4px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    z-index: 10;
    }
    
    .message:hover .message-actions {
    display: flex;
    }
    
    .message-action {
    background: none;
    border: none;
    padding: 6px 10px;
    cursor: pointer;
    font-size: 12px;
    color: #666;
    transition: color 0.2s;
    }
    
    .message-action:hover {
    color: #4a6cfa;
    }
    
    .input-container {
    display: flex;
    padding: 12px;
    background: white;
    border-top: 1px solid #e0e0e0;
    align-items: center;
    }
    
    .message-input {
    flex: 1;
    padding: 12px 16px;
    border: 1px solid #e0e0e0;
    border-radius: 24px;
    outline: none;
    font-size: 14px;
    transition: border-color 0.2s;
    margin-right: 8px;
    }
    
    .message-input:focus {
    border-color: #4a6cfa;
    }
    
    .send-button, .voice-button {
    background: #4a6cfa;
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    color: white;
    margin-left: 8px;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: background 0.2s;
    }
    
    .send-button:hover, .voice-button:hover {
    background: #3a5cd8;
    }
    
    .voice-button {
    background: #4CAF50;
    }
    
    .voice-button:hover {
    background: #3d8b40;
    }
    
    .voice-recording {
    display: none;
    align-items: center;
    justify-content: center;
    padding: 12px;
    background: #ffebee;
    color: #d32f2f;
    font-weight: 500;
    font-size: 14px;
    }
    
    .voice-recording.active {
    display: flex;
    }
    
    .recording-dot {
    width: 10px;
    height: 10px;
    background: #d32f2f;
    border-radius: 50%;
    margin-right: 8px;
    animation: pulse 1s infinite;
    }
    
    @keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
    }
    
    .edit-mode {
    background: #fff8e1;
    padding: 10px 16px;
    display: none;
    justify-content: space-between;
    align-items: center;
    font-size: 14px;
    color: #5d4037;
    border-bottom: 1px solid #ffe0b2;
    }
    
    .edit-mode.active {
    display: flex;
    }
    
    .edit-mode-cancel {
    background: none;
    border: none;
    color: #5d4037;
    cursor: pointer;
    font-weight: 600;
    padding: 4px 8px;
    border-radius: 4px;
    }
    
    .edit-mode-cancel:hover {
    background: rgba(93, 64, 55, 0.1);
    }
    
    .welcome-message {
    text-align: center;
    padding: 20px;
    color: #666;
    font-style: italic;
    font-size: 14px;
    }
    
    .voice-message-indicator {
    display: flex;
    align-items: center;
    padding: 18px 12px;
    background: rgba(0, 0, 0, 0.05);
    border-radius: 50px;
    margin-top: 4px;
    }
    
    .voice-message-indicator i {
    margin-right: 8px;
    color: #4a6cfa;
    }
    
    .system-notification {
    text-align: center;
    font-size: 12px;
    color: #999;
    margin: 8px 0;
    font-style: italic;
    }
    
    .typing-indicator {
    display: flex;
    align-items: center;
    padding: 8px 12px;
    background: #e9e9eb;
    border-radius: 18px;
    align-self: flex-start;
    margin-bottom: 16px;
    max-width: 100px;
    }
    
    .typing-dot {
    width: 6px;
    height: 6px;
    background: #999;
    border-radius: 50%;
    margin-right: 4px;
    animation: typingAnimation 1.4s infinite;
    }
    
    .typing-dot:nth-child(2) {
    animation-delay: 0.2s;
    }
    
    .typing-dot:nth-child(3) {
    animation-delay: 0.4s;
    }
    
    @keyframes typingAnimation {
    0%, 60%, 100% { transform: translateY(0); }
    30% { transform: translateY(-4px); }
    }
    
    .notification {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: #333;
    color: white;
    padding: 12px 20px;
    border-radius: 4px;
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.3s;
    }
    
    .notification.show {
    opacity: 1;
    }
    .loading {
    text-align: center;
    padding: 20px;
    color: #666;
    }
    
    .loading-spinner {
    border: 3px solid #f3f3f3;
    border-top: 3px solid #4a6cfa;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    animation: spin 1s linear infinite;
    margin: 0 auto 10px;
    }
    
    @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
    }
    
    </style>
    
      <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <!-- Firebase Firestore -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <!-- Firebase Authentication -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
</head>
<body>
    <div class="notification" id="notification"></div>
    
    <div class="chat-container" id="chat-container">
        <div class="chat-header">
        <div class="header-left">
        <div class="profile-image">
        <i class="fas fa-user"></i>
        </div>
        
            <div class="header-info">
            
                <div class="chat-title">Community Chat</div>
                <div class="online-info">
                    <div class="online-indicator"></div>
                    <span id="online-count">0 online</span>
                </div>
            </div>
            </div>
            <div class="header-actions">
                <button class="header-btn" id="search-btn">
                    <i class="fas fa-search"></i>
                </button>
                <button class="header-btn" id="menu-toggle">
                    <i class="fas fa-ellipsis-v"></i>
                </button>
            </div>
            <div class="dropdown-menu" id="dropdown-menu">
                <a href="#" id="about-link"><i class="fas fa-info-circle"></i> About Us</a>
                <a href="#" id="privacy-link"><i class="fas fa-shield-alt"></i> Privacy Policy</a>
            </div>
        </div>
        
        <div class="edit-mode" id="edit-mode">
            <div class="edit-mode-text">Editing message</div>
            <button class="edit-mode-cancel" id="edit-cancel">Cancel</button>
        </div>
        
        <div class="voice-recording" id="voice-recording">
            <div class="recording-dot"></div>
            Recording... Release to send
        </div>
        
        <div class="messages-container" id="messages-container">
            <div class="welcome-message">
                <i class="fas fa-comments" style="font-size: 24px; margin-bottom: 10px;"></i>
                  <div class="loading">
                  <div class="loading-spinner"></div>
                  <p>Loading messages...</p>
                  </div>
                  
                  </div>
        </div>
        
        <div class="input-container">
            <input type="text" class="message-input" id="message-input" placeholder="Type your message...">
            <button class="voice-button" id="voice-button">
            <i class="fas fa-microphone"></i>
            </button>
            <button class="send-button" id="send-button">
            <i class="fas fa-paper-plane"></i>
            </button>
        </div>
        
    </div>
<script>
        // Firebase configuration - replace with your actual config
        const firebaseConfig = {
            apiKey: "AIzaSyA_VmdBDnLbnYX8zdZs6Ol3yxJJSLn4LJY",
            authDomain: "portafluxchat-system.firebaseapp.com",
            projectId: "portafluxchat-system",
            storageBucket: "portafluxchat-system.firebasestorage.app",
            messagingSenderId: "768829431492",
            appId: "1:768829431492:web:3953467a079f1490627391"
            };
            
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        
        // DOM Elements
        const menuToggle = document.getElementById('menu-toggle');
        const dropdownMenu = document.getElementById('dropdown-menu');
        const messagesContainer = document.getElementById('messages-container');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        const voiceButton = document.getElementById('voice-button');
        const voiceRecording = document.getElementById('voice-recording');
        const onlineCount = document.getElementById('online-count');
        const editMode = document.getElementById('edit-mode');
        const editCancel = document.getElementById('edit-cancel');
        const searchBtn = document.getElementById('search-btn');
        const notification = document.getElementById('notification');
        
        // State variables
        let currentUser = null;
        let onlineUsers = 0;
        let isRecording = false;
        let mediaRecorder = null;
        let audioChunks = [];
        let editMessageId = null;
        let isSomeoneTyping = false;
        let messagesListener = null;
        let onlineUsersListener = null;
        
        // Initialize the chat
        async function initChat() {
            try {
                // Show loading state
                messagesContainer.innerHTML = `
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>Connecting to chat...</p>
                    </div>
                `;
                
                // Sign in anonymously
                const userCredential = await auth.signInAnonymously();
                currentUser = userCredential.user;
                
                // Enable input fields
                messageInput.disabled = false;
                sendButton.disabled = false;
                voiceButton.disabled = false;
                
                // Set up real-time listeners
                setupRealTimeListeners();
                
                // Set up event listeners
                setupEventListeners();
                
                // Remove loading indicator
                const loadingIndicator = document.querySelector('.loading');
                if (loadingIndicator) {
                    loadingIndicator.remove();
                }
                
                // Show welcome message if no messages
                if (messagesContainer.children.length === 0) {
                    const welcomeMsg = document.createElement('div');
                    welcomeMsg.classList.add('welcome-message');
                    welcomeMsg.innerHTML = `
                        <i class="fas fa-comments" style="font-size: 24px; margin-bottom: 10px;"></i>
                        <p>Welcome to the community chat!</p>
                        <p>Messages will appear here.</p>
                    `;
                    messagesContainer.appendChild(welcomeMsg);
                }
            } catch (error) {
                showNotification('Error initializing chat: ' + error.message, 'error');
                console.error('Error initializing chat:', error);
                
                // Show error state
                messagesContainer.innerHTML = `
                    <div class="welcome-message">
                        <i class="fas fa-exclamation-triangle" style="font-size: 24px; margin-bottom: 10px; color: #f44336;"></i>
                        <p>Error connecting to chat</p>
                        <p>Please refresh the page to try again</p>
                    </div>
                `;
            }
        }
        
        // Set up real-time listeners
        function setupRealTimeListeners() {
            // Listen for new messages
            messagesListener = db.collection('messages')
                .where('deleted', '==', false)
                .orderBy('timestamp', 'desc')
                .limit(50)
                .onSnapshot(snapshot => {
                    // Clear existing messages except welcome message
                    const welcomeMsg = document.querySelector('.welcome-message');
                    messagesContainer.innerHTML = '';
                    if (welcomeMsg) {
                        messagesContainer.appendChild(welcomeMsg);
                    }
                    
                    // Add all messages
                    snapshot.forEach(doc => {
                        const message = {
                            id: doc.id,
                            ...doc.data()
                        };
                        addMessageToChat(message);
                    });
                    
                    // Scroll to bottom
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }, error => {
                    console.error('Error listening to messages:', error);
                    showNotification('Error loading messages: ' + error.message, 'error');
                });
                
            // Listen for online users count
            onlineUsersListener = db.collection('onlineUsers')
                .onSnapshot(snapshot => {
                    onlineUsers = snapshot.size;
                    onlineCount.textContent = `${onlineUsers} online`;
                }, error => {
                    console.error('Error listening to online users:', error);
                });
                
            // Add current user to online users
            db.collection('onlineUsers').doc(currentUser.uid).set({
                userId: currentUser.uid,
                lastSeen: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            // Update last seen periodically
            setInterval(() => {
                if (currentUser) {
                    db.collection('onlineUsers').doc(currentUser.uid).set({
                        userId: currentUser.uid,
                        lastSeen: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
            }, 30000);
        }
        
        // Set up event listeners
        function setupEventListeners() {
            // Menu toggle
            menuToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                dropdownMenu.classList.toggle('show');
            });
            
            // Search button
            searchBtn.addEventListener('click', () => {
                showNotification('Search functionality would be implemented here');
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!menuToggle.contains(e.target) && !dropdownMenu.contains(e.target)) {
                    dropdownMenu.classList.remove('show');
                }
            });
            
            // Send message on button click
            sendButton.addEventListener('click', sendMessage);
            
            // Send message on Enter key
            messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            // Voice message functionality
            voiceButton.addEventListener('mousedown', startRecording);
            voiceButton.addEventListener('mouseup', stopRecording);
            voiceButton.addEventListener('touchstart', (e) => {
                e.preventDefault();
                startRecording();
            });
            voiceButton.addEventListener('touchend', (e) => {
                e.preventDefault();
                stopRecording();
            });
            
            // Edit mode cancel
            editCancel.addEventListener('click', cancelEdit);
            
            // About and Privacy links
            document.getElementById('about-link').addEventListener('click', (e) => {
                e.preventDefault();
                showNotification('About Us: This is a community chat system designed for real-time communication.');
            });
            
            document.getElementById('privacy-link').addEventListener('click', (e) => {
                e.preventDefault();
                showNotification('Privacy Policy: We value your privacy. Your messages are secure and we do not share your data with third parties.');
            });
            
            // Remove user from online users when page is closed or refreshed
            window.addEventListener('beforeunload', () => {
                if (currentUser) {
                    db.collection('onlineUsers').doc(currentUser.uid).delete();
                }
            });
        }
        
        // Send a message
        async function sendMessage() {
            const text = messageInput.value.trim();
            
            if (text) {
                // Check for restricted content
                if (hasRestrictedContent(text)) {
                    showNotification('Message contains restricted content (phone numbers, emails, or links). Please remove them.', 'error');
                    return;
                }
                
                if (editMessageId) {
                    // Edit existing message
                    await editExistingMessage(editMessageId, text);
                    editMessageId = null;
                    editMode.classList.remove('active');
                } else {
                    // Create new message
                    try {
                        await db.collection('messages').add({
                            text: text,
                            userId: currentUser.uid,
                            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                            isVoice: false,
                            deleted: false
                        });
                    } catch (error) {
                        showNotification('Error sending message: ' + error.message, 'error');
                        console.error('Error sending message:', error);
                    }
                }
                
                messageInput.value = '';
            }
        }
        
        // Add message to chat UI
        function addMessageToChat(message) {
            const welcomeMsg = document.querySelector('.welcome-message');
            if (welcomeMsg) {
                welcomeMsg.remove();
            }
            
            const messageEl = document.createElement('div');
            messageEl.classList.add('message');
            messageEl.classList.add(message.userId === currentUser.uid ? 'own' : 'other');
            messageEl.id = `message-${message.id}`;
            
            // Format timestamp
            let timeText = 'Just now';
            if (message.timestamp) {
                const timestamp = message.timestamp.toDate();
                timeText = timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                // If edited, show edit time
                if (message.edited) {
                    timeText += ' (edited)';
                }
            }
            
            messageEl.innerHTML = `
                <div class="message-info">
                    <div class="message-user">${message.userId}</div>
                    <div class="message-time">${timeText}</div>
                </div>
                <div class="message-content">
                    ${message.text}
                    <div class="message-actions">
                        ${message.userId === currentUser.uid ? `
                            <button class="message-action edit-btn" data-id="${message.id}"><i class="fas fa-edit"></i></button>
                            <button class="message-action delete-btn" data-id="${message.id}"><i class="fas fa-trash"></i></button>
                        ` : ''}
                    </div>
                </div>
            `;
            
            messagesContainer.appendChild(messageEl);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Add event listeners for edit/delete buttons
            if (message.userId === currentUser.uid) {
                const editBtn = messageEl.querySelector('.edit-btn');
                const deleteBtn = messageEl.querySelector('.delete-btn');
                
                editBtn.addEventListener('click', () => {
                    editMessage(message.id, message.text);
                });
                
                deleteBtn.addEventListener('click', () => {
                    deleteMessage(message.id);
                });
            }
        }
        
        // Edit message
        function editMessage(messageId, messageText) {
            messageInput.value = messageText;
            messageInput.focus();
            
            editMessageId = messageId;
            editMode.classList.add('active');
        }
        
        // Cancel edit
        function cancelEdit() {
            editMessageId = null;
            editMode.classList.remove('active');
            messageInput.value = '';
        }
        
        // Edit existing message in Firestore
        async function editExistingMessage(messageId, newText) {
            try {
                // Check for restricted content
                if (hasRestrictedContent(newText)) {
                    showNotification('Message contains restricted content (phone numbers, emails, or links). Please remove them.', 'error');
                    return;
                }
                
                await db.collection('messages').doc(messageId).update({
                    text: newText,
                    edited: true,
                    editTimestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
            } catch (error) {
                showNotification('Error editing message: ' + error.message, 'error');
                console.error('Error editing message:', error);
            }
        }
        
        // Delete message
        async function deleteMessage(messageId) {
            try {
                await db.collection('messages').doc(messageId).update({
                    deleted: true,
                    deleteTimestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Remove from UI
                const messageEl = document.getElementById(`message-${messageId}`);
                if (messageEl) {
                    messageEl.remove();
                }
                
                // Show welcome message if no messages left
                if (messagesContainer.children.length === 0) {
                    const welcomeMsg = document.createElement('div');
                    welcomeMsg.classList.add('welcome-message');
                    welcomeMsg.innerHTML = `
                        <i class="fas fa-comments" style="font-size: 24px; margin-bottom: 10px;"></i>
                        <p>Welcome to the community chat!</p>
                        <p>Messages will appear here.</p>
                    `;
                    messagesContainer.appendChild(welcomeMsg);
                }
            } catch (error) {
                showNotification('Error deleting message: ' + error.message, 'error');
                console.error('Error deleting message:', error);
            }
        }
        
        // Check for restricted content
        function hasRestrictedContent(text) {
            const phoneRegex = /\b\d{3}[-.]?\d{3}[-.]?\d{4}\b/;
            const emailRegex = /\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/;
            const urlRegex = /https?:\/\/[^\s]+/;
            
            return phoneRegex.test(text) || emailRegex.test(text) || urlRegex.test(text);
        }
        
        // Start voice recording
        function startRecording() {
            isRecording = true;
            voiceRecording.classList.add('active');
            
            // In a real app, this would use the Web Speech API
            // For this demo, we'll simulate the recording process
            audioChunks = [];
        }
        
        // Stop voice recording and send
        async function stopRecording() {
            if (!isRecording) return;
            
            isRecording = false;
            voiceRecording.classList.remove('active');
            
            // In a real app, this would process the recorded audio
            // For this demo, we'll simulate converting to text
            const voiceMessages = [
                "Hello everyone!",
                "How are you doing?",
                "I think this is a great feature!",
                "What's everyone working on?",
                "Nice to chat with you all!"
            ];
            
            const randomMessage = voiceMessages[Math.floor(Math.random() * voiceMessages.length)];
            
            // Create message from voice
            try {
                await db.collection('messages').add({
                    text: randomMessage,
                    userId: currentUser.uid,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    isVoice: true,
                    deleted: false
                });
            } catch (error) {
                showNotification('Error sending voice message: ' + error.message, 'error');
                console.error('Error sending voice message:', error);
            }
        }
        
        // Show notification
        function showNotification(message, type = 'info') {
            notification.textContent = message;
            notification.style.background = type === 'error' ? '#f44336' : '#333';
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Initialize the chat when page loads
        window.addEventListener('load', initChat);
    </script>
</body>
</html>>